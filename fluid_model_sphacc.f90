      module fluid_model_sphacc

      use phys_constants 
      use interpolate, only: get_weight

      implicit none

      real, dimension(:), allocatable :: uvals, vvals
      real, dimension(:), allocatable :: rvals, tvals

      contains

        subroutine init_sphacc()
        integer :: I
        allocate(uvals(498)); allocate(vvals(498))
        allocate(rvals(461)); allocate(tvals(461))
        uvals=(/(real(I-1)*.001+1./399.,I=1,498)/)
!        write(6,*) 'init sphacc'
        tvals=(/1.0432723208096263d11, 1.0354290469460934d11, &
        1.0276452856888586d11, 1.0199205840715575d11, & 
        1.0122544925835513d11, 1.0046465651434933d11, & 
        9.970963590730995d10, 9.89603435071123d10, & 
        9.821673571875267d10, 9.74787692797853d10, & 
        9.674640125777953d10, 9.601958904779565d10, & 
        9.529829036988136d10, 9.458246326658598d10, & 
        9.387206610049529d10, 9.316705755178381d10, & 
        9.246739661578726d10, 9.177304260059256d10, & 
        9.10839551246473d10, 9.040009411438622d10, & 
        8.972141980187793d10, 8.904789272248732d10, & 
        8.837947371255829d10, 8.77161239071119d10, & 
        8.705780473756477d10, 8.640447792946234d10, & 
        8.575610550023166d10, 8.511264975695018d10, & 
        8.447407329413266d10, 8.38403389915334d10, 8.32114100119678d10, &
        8.258724979914775d10, 8.196782207553683d10, & 
        8.135309084021855d10, 8.074302036678432d10, & 
        8.01375752012344d10, 7.953672015989789d10, & 
        7.894042032736653d10, 7.834864105444577d10, & 
        7.776134795611966d10, 7.717850690953471d10, & 
        7.66000840519948d10, 7.602604577897603d10, & 
        7.545635874215231d10, 7.489098984744075d10, & 
        7.432990625305751d10, 7.377307536759195d10, & 
        7.322046484809366d10, 7.26720425981758d10, & 
        7.212777676613014d10, 7.158763574306056d10, & 
        7.105158816102641d10, 7.051960289120476d10, & 
        6.999164904206198d10, 6.946769595754402d10, & 
        6.894771321527583d10, 6.84316706247792d10, & 
        6.791953822570057d10, 6.741128628605514d10, & 
        6.69068853004813d10, 6.640630598851299d10, & 
        6.590951929285986d10, 6.541649637770609d10, & 
        6.492720862701668d10, 6.444162764286281d10, & 
        6.395972524375372d10, 6.348147346298668d10, 6.3006844547006d10, & 
        6.253581095377757d10, 6.2068345351171974d10, & 
        6.160442061536486d10, 6.11440098292443d10, 6.06870862808361d10, & 
        6.023362346173491d10, 5.978359506555358d10, & 
        5.933697498637846d10, 5.889373731724192d10, & 
        5.845385634860252d10, 5.801730656683954d10, & 
        5.75840626527559d10, 5.715409948009748d10, & 
        5.672739211407764d10, 5.63039158099192d10, & 
        5.5883646011401436d10, 5.546655834942488d10, & 
        5.50526286405804d10, 5.464183288573427d10, & 
        5.4234147268621346d10, 5.382954815445137d10, & 
        5.342801208852169d10, 5.302951579484665d10, & 
        5.263403617479083d10, 5.224155030571957d10, & 
        5.1852035439653015d10, 5.1465469001936806d10, & 
        5.108182858991702d10, 5.070109197163072d10, & 
        5.0323237084502365d10, 4.994824203405304d10, & 
        4.957608509261608d10, 4.920674469806828d10, & 
        4.884019945256329d10, 4.847642812128265d10, & 
        4.811540963118845d10, 4.775712306979365d10, & 
        4.7401547683933945d10, 4.704866287855525d10, & 
        4.669844821550656d10, 4.635088341234511d10, & 
        4.600594834114648d10, 4.5663623027329124d10, & 
        4.532388764848234d10, 4.49867225332091d10, & 
        4.465210815997116d10, 4.432002515594989d10, & 
        4.3990454295909035d10, 4.3663376501072266d10, & 
        4.333877283800497d10, 4.3016624517507355d10, & 
        4.269691289351264d10, 4.2379619461999435d10, & 
        4.206472585990482d10, 4.175221386405373d10, & 
        4.144206539008873d10, 4.1134262491415855d10, & 
        4.082878735815091d10, 4.0525622316079666d10, & 
        4.02247498256226d10, 3.9926152480810295d10, & 
        3.96298130082624d10, 3.9335714266180275d10, & 
        3.9043839243340775d10, 3.8754171058104774d10, & 
        3.84666929574261d10, 3.818138831587456d10, & 
        3.789824063466061d10, 3.761723354067275d10, & 
        3.733835078551838d10, 3.706157624457458d10, & 
        3.678689391604272d10, 3.651428792001616d10, & 
        3.624374249754763d10, 3.597524200973129d10, & 
        3.5708770936784454d10, 3.5444313877143875d10, & 
        3.518185554656157d10, 3.492138077721347d10, & 
        3.466287451681104d10, 3.440632182772291d10, & 
        3.415170788609877d10, 3.3899017981005753d10, & 
        3.364823751356505d10, 3.3399351996101883d10, & 
        3.315234705129509d10, 3.290720841133983d10, & 
        3.2663921917110256d10, 3.2422473517334564d10, & 
        3.218284926777209d10, 3.1945035330399174d10, & 
        3.1709017972598305d10, 3.147478356635871d10, & 
        3.1242318587476223d10, 3.101160961476628d10, & 
        3.078264332927588d10, 3.0555406513509113d10, & 
        3.032988605065128d10, 3.010606892380432d10, & 
        2.988394221522532d10, 2.9663493105572968d10, & 
        2.9444708873155846d10, 2.9227576893192364d10, & 
        2.9012084637069725d10,  2.8798219671615368d10, & 
        2.8585969658367302d10, 2.837532235285607d10, & 
        2.816626560388678d10, 2.7958787352831535d10, & 
        2.775287563292358d10, 2.7548518568559456d10, & 
        2.7345704374603054d10, 2.7144421355700695d10, & 
        2.6944657905594265d10, 2.6746402506446968d10, & 
        2.6549643728166866d10, 2.6354370227743427d10, & 
        2.6160570748581345d10, 2.5968234119845783d10, & 
        2.5777349255808548d10, 2.5587905155202393d10, & 
        2.539989090057632d10, 2.5213295657660873d10, & 
        2.5028108674732635d10, 2.48443192819898d10, & 
        2.466191689092609d10, 2.448089099371554d10, & 
        2.4301231162596306d10, 2.412292704926443d10, & 
        2.3945968384268467d10, 2.3770344976411003d10, & 
        2.3596046712152122d10, 2.3423063555022083d10, & 
        2.325138554503262d10, 2.3081002798097843d10, & 
        2.2911905505456757d10, 2.2744083933100945d10, & 
        2.257752842120674d10, 2.2412229383571747d10, & 
        2.2248177307055634d10, 2.2085362751025146d10, & 
        2.192377634680344d10, 2.1763408797123856d10, & 
        2.1604250875587456d10, 2.1446293426125164d10, & 
        2.1289527362463707d10, 2.11339436675961d10, & 
        2.097953339325558d10, 2.082628765939399d10, & 
        2.06741976536645d10, 2.052325463090745d10, & 
        2.037344991264089d10, 2.0224774886554813d10, & 
        2.007722100600918d10, 1.993077978953588d10, & 
        1.9785442820344715d10, 1.9641201745832954d10, & 
        1.949804827709865d10, 1.935597418845804d10, & 
        1.921497131696626d10, 1.9075031561942223d10, & 
        1.893614688449653d10, 1.879830930706385d10, & 
        1.8661510912938076d10, 1.852574384581192d10, & 
        1.8391000309319176d10, 1.825727256658148d10, & 
        1.812455293975768d10, 1.7992833809597332d10, & 
        1.786210761499759d10, 1.773236685256318d10, & 
        1.760360407617004d10, 1.7475811896532486d10, & 
        1.7348982980773464d10, 1.7223110051998478d10, & 
        1.709818588887223d10, 1.6974203325199535d10, & 
        1.6851155249508448d10, 1.6729034604637543d10, & 
        1.6607834387325666d10, 1.648754764780571d10, & 
        1.6368167489400505d10, 1.6249687068123163d10, & 
        1.6132099592279291d10, 1.6015398322073475d10, & 
        1.5899576569217855d10, 1.578462769654448d10, & 
        1.5670545117620398d10, 1.5557322296365885d10, & 
        1.5444952746675676d10, 1.5333430032043213d10, & 
        1.5222747765187664d10, 1.5112899607684433d10, & 
        1.5003879269597694d10, 1.4895680509117125d10, & 
        1.4788297132195929d10, 1.468172299219365d10, & 
        1.457595198951997d10, 1.4470978071282566d10, & 
        1.4366795230937344d10, 1.4263397507941957d10, & 
        1.4160778987410835d10, 1.4058933799775156d10, & 
        1.3957856120442951d10, 1.3857540169464552d10, & 
        1.3757980211198597d10, 1.3659170553982283d10, & 
        1.3561105549803198d10, 1.3463779593974955d10, & 
        1.3367187124814327d10, 1.3271322623322031d10, & 
        1.3176180612865229d10, 1.308175565886378d10, & 
        1.2988042368477774d10, 1.2895035390299038d10, & 
        1.2802729414043787d10, 1.2711119170249432d10, & 
        1.2620199429972355d10, 1.2529965004489504d10, & 
        1.2440410745001833d10, 1.2351531542340631d10, & 
        1.2263322326675753d10, 1.2175778067227442d10, & 
        1.2088893771979355d10, 1.200266448739538d10, & 
        1.1917085298137669d10, 1.1832151326788376d10, & 
        1.1747857733572536d10, 1.1664199716084843d10, & 
        1.1581172509017534d10, 1.149877138389201d10, & 
        1.1416991648791256d10, 1.1335828648096754d10, & 
        1.1255277762225817d10, 1.1175334407372963d10, & 
        1.1095994035252441d10, 1.1017252132844137d10, & 
        1.093910422214149d10, 1.0861545859901659d10, & 
        1.0784572637398363d10, 1.0708180180177496d10, & 
        1.0632364147813986d10, 1.0557120233672634d10, & 
        1.0482444164669897d10, 1.0408331701039614d10, & 
        1.033477863609945d10, 1.0261780796021477d10, & 
        1.0189334039603914d10, 1.011743425804609d10, & 
        1.0046077374725578d10, 9.975259344977928d9, & 
        9.904976155878542d9, 9.835223826027775d9, 9.7659984053378d9, & 
        9.697295974822481d9, 9.629112646389557d9, 9.561444562635609d9, & 
        9.494287896643538d9, 9.42763885178253d9,  9.361493661510828d9, &
        9.295848589181376d9, 9.230699927849634d9, 9.166044000084562d9, & 
        9.101877157782154d9, 9.038195781982151d9, 8.974996282686829d9, &  
        8.91227509868383d9, 8.850028697370638d9, 8.788253574583057d9, & 
        8.726946254426367d9, 8.666103289109386d9, 8.605721258781633d9, & 
        8.545796771374778d9, 8.48632646244522d9, 8.42730699502264d9, & 
        8.368735059459624d9, 8.31060737328659d9, 8.252920681069016d9, & 
        8.195671754269417d9, 8.138857391112074d9, 8.082474416452737d9, & 
        8.026519681651276d9,  7.970990064449749d9, 7.9158824688529625d9, & 
        7.861193825015373d9, 7.8069210891311655d9, 7.753061243329559d9, & 
        7.699611295574764d9, 7.646568279571402d9, 7.593929254674754d9, & 
        7.541691305806475d9, 7.489851543375929d9, 7.43840710320821d9, & 
        7.387355146476301d9, 7.336692859642546d9, 7.286417454403702d9, & 
        7.23652616764545d9, 7.187016261402646d9, 7.137885022827815d9, & 
        7.089129764167779d9, 7.040747822748278d9, 6.992736560967512d9, & 
        6.945093366299686d9, 6.897815651306494d9, 6.850900853661777d9, & 
        6.804346436183252d9, 6.758149886880303d9, 6.712308719008729d9, & 
        6.666820471143156d9, 6.621682707259528d9, 6.576893016833976d9, &
        6.532449014954875d9, 6.488348342454791d9, 6.444588666055018d9, & 
        6.401167678531888d9, 6.35808309890099d9, 6.315332672623823d9, & 
        6.27291417183337d9, 6.230825395587799d9, 6.189064170146075d9, & 
        6.147628349272385d9, 6.106515814569554d9, 6.065724475843918d9, & 
        6.0252522715024395d9, 5.985097168988465d9,  5.945257165253679d9, &
        5.905730287274554d9, 5.866514592611596d9, 5.827608170019448d9, & 
        5.789009140109166d9, 5.750715656066905d9, 5.71272590443578d9, & 
        5.675038105964413d9, 5.637650516529525d9, 5.600561428136316d9, & 
        5.56376917000769d9, 5.527272109766128d9, 5.491068654720618d9, &
        5.455157253265636d9,  5.419536396403869d9, 5.384204619406136d9, & 
        5.349160503618162d9, 5.314402678434898d9, 5.279929823453508d9, & 
        5.245740670827025d9, 5.211834007840289d9, 5.178208679730264d9, & 
        5.144863592778241d9, 5.11179771770556d9, 5.079010093406243d9, &
        5.046499831057296d9,  5.014266118648454d9, 4.982308225987597d9, & 
        4.950625510237075d9, 4.919217422046332d9, 4.888083512364835d9, & 
        4.857223440019068d9, 4.826636980160893d9, 4.796324033704844d9, & 
        4.766284637899885d9, 4.736518978195427d9, 4.707027401598242d9, & 
        4.677810431749175d9, 4.648868785987896d9, 4.62020339473015d9, & 
        4.591815423537231d9, 4.563706298349911d9, 4.535877734429742d9, & 
        4.508331769697253d9, 4.481070803283492d9, 4.454097640313985d9, & 
        4.427415544172052d9, 4.401028297805604d9, 4.374940276026472d9, & 
        4.349156531269041d9, 4.32368289596004d9, 4.298526105536765d9, & 
        4.2736939473689837d9, 4.249195442478909d9, &
        4.2250410692215323d9,  4.201243041240885d9, 4.177815656500194d9, & 
        4.1547757406784925d9, 4.132143217700819d9, & 
        4.1099418545062494d9, 4.0882002490763307d9, & 
        4.066953165430988d9, 4.046243375615008d9, 4.0261242634599104d9, & 
        4.00666361071293d9, 3.9879492899573174d9, 3.970098177103501d9, & 
        3.953270813872671d9/)

       rvals=(/2., 2.02316, 2.04659, 2.07029, 2.09426, 2.11851, 2.14304, & 
        2.16785, & 
        2.19296, 2.21835, 2.24404, 2.27002, 2.29631, 2.3229, 2.3498, & 
        2.37701, &
        2.40453, 2.43237, 2.46054, 2.48903, 2.51785, 2.54701, 2.5765, & 
        2.60633, 2.63651, 2.66704, 2.69793, 2.72917, 2.76077, 2.79274, & 
        2.82508, 2.85779, 2.89088, 2.92436, 2.95822, 2.99247, 3.02712, & 
        3.06218, 3.09763, 3.1335, 3.16979, 3.20649, 3.24362, 3.28118, & 
        3.31918, 3.35761, 3.39649, 3.43582, 3.4756, 3.51585, 3.55656, & 
        3.59774, 3.6394, 3.68155, 3.72418, 3.7673, 3.81092, 3.85505, &
        3.89969, & 
        3.94485, 3.99053, 4.03673, 4.08348, 4.13076, 4.17859, 4.22698, & 
        4.27593, 4.32544, 4.37553, 4.42619, 4.47744, 4.52929, 4.58174, & 
        4.63479, 4.68846, 4.74275, 4.79767, 4.85322, 4.90942, 4.96627, &
        5.02378, 5.08195, 5.14079, 5.20032, 5.26054, 5.32145, 5.38307, &
        5.44541, 5.50846, 5.57225, 5.63677, 5.70204, 5.76807, 5.83486, &
        5.90242, 5.97077, 6.03991, 6.10985, 6.18059, 6.25216, 6.32456, &
        6.39779, 6.47188, 6.54682, 6.62263, 6.69931, 6.77689, 6.85536, &
        6.93474, 7.01504, 7.09627, 7.17844, 7.26156, 7.34565, 7.43071, &
        7.51675, 7.60379, 7.69184, 7.78091, 7.87101, 7.96215, 8.05434, &
        8.14761, 8.24195, 8.33739, 8.43393, 8.53159, 8.63039, 8.73032, &
        8.83141, 8.93368, 9.03712, 9.14177, 9.24763, 9.35471, 9.46303, &
        9.57261, 9.68345, 9.79558, 9.90901, 10.0237, 10.1398, 10.2572, &
        10.376, 10.4962, 10.6177, 10.7406, 10.865, 10.9908, 11.1181, &
        11.2468, &
        11.3771, 11.5088, 11.6421, 11.7769, 11.9132, 12.0512, 12.1907, &
        12.3319, 12.4747, 12.6192, 12.7653, 12.9131, 13.0626, 13.2139, &
        13.3669, 13.5217, 13.6782, 13.8366, 13.9968, 14.1589, 14.3229, &
        14.4887, 14.6565, 14.8262, 14.9979, 15.1716, 15.3472, 15.525, &
        15.7047, 15.8866, 16.0705, 16.2566, 16.4449, 16.6353, 16.8279, &
        17.0228, 17.2199, 17.4193, 17.621, 17.825, 18.0314, 18.2402,&
        18.4514, &
        18.6651, 18.8812, 19.0999, 19.321, 19.5448, 19.7711, 20.,&
        20.2316, &
        20.4659, 20.7029, 20.9426, 21.1851, 21.4304, 21.6785, 21.9296, &
        22.1835, 22.4404, 22.7002, 22.9631, 23.229, 23.498, 23.7701, &
        24.0453, &
        24.3237, 24.6054, 24.8903, 25.1785, 25.4701, 25.765, 26.0633, &
        26.3651, 26.6704, 26.9793, 27.2917, 27.6077, 27.9274, 28.2508, &
        28.5779, 28.9088, 29.2436, 29.5822, 29.9247, 30.2712, 30.6218, &
        30.9763, 31.335, 31.6979, 32.0649, 32.4362, 32.8118, 33.1918, &
        33.5761, 33.9649, 34.3582, 34.756, 35.1585, 35.5656, 35.9774,&
        36.394, &
        36.8155, 37.2418, 37.673, 38.1092, 38.5505, 38.9969, 39.4485, &
        39.9053, 40.3673, 40.8348, 41.3076, 41.7859, 42.2698, 42.7593, &
        43.2544, 43.7553, 44.2619, 44.7744, 45.2929, 45.8174, 46.3479, &
        46.8846, 47.4275, 47.9767, 48.5322, 49.0942, 49.6627, 50.2378, &
        50.8195, 51.4079, 52.0032, 52.6054, 53.2145, 53.8307, 54.4541, &
        55.0846, 55.7225, 56.3677, 57.0204, 57.6807, 58.3486, 59.0242, &
        59.7077, 60.3991, 61.0985, 61.8059, 62.5216, 63.2456, 63.9779, &
        64.7188, 65.4682, 66.2263, 66.9931, 67.7689, 68.5536, 69.3474, &
        70.1504, 70.9627, 71.7844, 72.6156, 73.4565, 74.3071, 75.1675, &
        76.0379, 76.9184, 77.8091, 78.7101, 79.6215, 80.5434, 81.4761, &
        82.4195, 83.3739, 84.3393, 85.3159, 86.3039, 87.3032, 88.3141, &
        89.3368, 90.3712, 91.4177, 92.4763, 93.5471, 94.6303, 95.7261, &
        96.8345, 97.9558, 99.0901, 100.237, 101.398, 102.572, 103.76, &
        104.962, 106.177, 107.406, 108.65, 109.908, 111.181, 112.468, &
        113.771, 115.088, 116.421, 117.769, 119.132, 120.512, 121.907, &
        123.319, 124.747, 126.192, 127.653, 129.131, 130.626, 132.139, &
        133.669, 135.217, 136.782, 138.366, 139.968, 141.589, 143.229, &
        144.887, 146.565, 148.262, 149.979, 151.716, 153.472, 155.25, &
        157.047, 158.866, 160.705, 162.566, 164.449, 166.353, 168.279, &
        170.228, 172.199, 174.193, 176.21, 178.25, 180.314, 182.402, &
        184.514, &
        186.651, 188.812, 190.999, 193.21, 195.448, 197.711, 200., &
        202.316, &
        204.659, 207.029, 209.426, 211.851, 214.304, 216.785, 219.296, &
        221.835, 224.404, 227.002, 229.631, 232.29, 234.98, 237.701, &
        240.453, &
        243.237, 246.054, 248.903, 251.785, 254.701, 257.65, 260.633,&
        263.651, &
        266.704, 269.793, 272.917, 276.077, 279.274, 282.508, 285.779, &
        289.088, 292.436, 295.822, 299.247, 302.712, 306.218, 309.763, &
        313.35, 316.979, 320.649, 324.362, 328.118, 331.918, 335.761, &
        339.649, 343.582, 347.56, 351.585, 355.656, 359.774, 363.94, &
        368.155, &
        372.418, 376.73, 381.092, 385.505, 389.969, 394.485, 399.053/)

        vvals = (/0.0373538, 0.0506498, 0.0611878, 0.0705209, 0.0790334,&
         0.0869245, 0.0943196, &
         0.101305, 0.107945, 0.114287, 0.120369, 0.126221, 0.131868,&
           .13733,  &
         0.142626, 0.147769, 0.152772, 0.157647, 0.162403, 0.167048,&
           .17159, &
         0.176035, 0.18039, 0.18466, 0.18885, 0.192964, 0.197007, &
           .200981, 0.204891, &
         0.208739, 0.212529, 0.216262, 0.219942, 0.223571, 0.22715, &
           .230683, 0.23417, &
         0.237613, 0.241014, 0.244375, 0.247696, 0.25098, 0.254228, &
           .25744, 0.260618, &
          0.263763, 0.266876, 0.269959, 0.273011, 0.276033, 0.279028,&
           .281995,  &
        0.284935, 0.287848, 0.290737, 0.293601, 0.29644, 0.299256, &
          .302049, 0.30482, &
           0.307569, 0.310296, 0.313003, 0.31569, 0.318356, 0.321003,&
             .323631, &
         0.326241, 0.328832, 0.331405, 0.333961, 0.3365, 0.339022, &
           .341527, 0.344017, &
         0.346491, 0.348949, 0.351392, 0.35382, 0.356233, 0.358632, &
           .361017, &
         0.363387, 0.365745, 0.368089, 0.370419, 0.372737, 0.375042, &
           .377334, &
         0.379614, 0.381882, 0.384138, 0.386383, 0.388616, 0.390837, &
           .393047, &
         0.395246, 0.397434, 0.399612, 0.401779, 0.403936, 0.406082, &
           .408218, &
         0.410344, 0.412461, 0.414568, 0.416665, 0.418753, 0.420831, &
           .422901, &
         0.424961, 0.427012, 0.429055, 0.431089, 0.433114, 0.435131,& 
           .437139, &
         0.43914, 0.441132, 0.443116, 0.445091, 0.44706, 0.44902, &
           .450973, 0.452918,& 
         0.454855, 0.456785, 0.458708, 0.460624, 0.462532, 0.464434,&
           .466328, &
         0.468215, 0.470096, 0.47197, 0.473837, 0.475697, 0.477551,&
           .479399, &
         0.481239, 0.483074, 0.484902, 0.486725, 0.488541, 0.49035,&
           .492154, &
         0.493952, 0.495744, 0.49753, 0.49931, 0.501085, 0.502854, &
           .504617, 0.506375,& 
         0.508127, 0.509874, 0.511615, 0.513351, 0.515081, 0.516807,&
           .518527,  &
        0.520242, 0.521951, 0.523656, 0.525356, 0.52705, 0.52874, &
          .530425, 0.532105,& 
         0.53378, 0.53545, 0.537116, 0.538777, 0.540433, 0.542085, &
           .543732, 0.545375,& 
         0.547013, 0.548646, 0.550275, 0.5519, 0.553521, 0.555137, &
           .556748, 0.558356, &
          0.559959, 0.561558, 0.563154, 0.564744, 0.566331, 0.567914&
           , 0.569493, &
         0.571067, 0.572638, 0.574205, 0.575768, 0.577327, 0.578882,&
           .580434,  &
         0.581981, 0.583525, 0.585065, 0.586602, 0.588135, 0.589664,&
           .591189, &
         0.592711, 0.594229, 0.595744, 0.597255, 0.598763, 0.600267,&
           .601768, &
         0.603265, 0.604759, 0.60625, 0.607737, 0.609221, 0.610702, &
           .612179, &
         0.613653, 0.615124, 0.616592, 0.618056, 0.619517, 0.620975,&
           .62243, &
         0.623882, 0.625331, 0.626776, 0.628219, 0.629658, 0.631095&
          , 0.632528, &
        0.633959, 0.635386, 0.636811, 0.638233, 0.639651, 0.641067,&
          .64248, 0.64389,& 
        0.645298, 0.646702, 0.648104, 0.649503, 0.650899, 0.652292,&
          .653683, &
        0.655071, 0.656456, 0.657839, 0.659218, 0.660596, 0.66197, &
          .663342, &
        0.664711, 0.666078, 0.667442, 0.668804, 0.670163, 0.671519,&
          .672873, &
        0.674225, 0.675574, 0.67692, 0.678264, 0.679606, 0.680945, &
          .682282, &
        0.683616, 0.684948, 0.686277, 0.687604, 0.688929, 0.690252, &
          .691572, &
        0.692889, 0.694205, 0.695518, 0.696829, 0.698137, 0.699444, &
          .700748, &
        0.702049, 0.703349, 0.704646, 0.705942, 0.707235, 0.708525, &
          .709814, 0.7111,& 
        0.712385, 0.713667, 0.714947, 0.716225, 0.717501, 0.718774,&
          .720046, &
        0.721315, 0.722583, 0.723848, 0.725112, 0.726373, 0.727632,&
          .72889, &
        0.730145, 0.731398, 0.73265, 0.733899, 0.735146, 0.736392, &
          .737635, &
        0.738877, 0.740116, 0.741354, 0.74259, 0.743824, 0.745056, &
          .746286, &
        0.747514, 0.74874, 0.749965, 0.751187, 0.752408, 0.753627, &
          .754844, &
        0.756059, 0.757273, 0.758485, 0.759695, 0.760903, 0.762109,&
          .763314, &
        0.764516, 0.765717, 0.766917, 0.768114, 0.76931, 0.770504, &
          .771697, &
        0.772887, 0.774076, 0.775263, 0.776449, 0.777633, 0.778815, &
          .779996, &
         0.781175, 0.782352, 0.783528, 0.784702, 0.785874, 0.787045,&
           .788214, &
        0.789381, 0.790547, 0.791711, 0.792874, 0.794035, 0.795195, &
          .796353, &
        0.797509, 0.798664, 0.799817, 0.800969, 0.802119, 0.803268, &
          .804415, &
        0.805561, 0.806705, 0.807848, 0.808989, 0.810128, 0.811266, &
          .812403, &
        0.813538, 0.814672, 0.815804, 0.816935, 0.818064, 0.819192,&
          .820319, &
        0.821444, 0.822567, 0.823689, 0.82481, 0.825929, 0.827047, &
          .828164, &
        0.829279, 0.830392, 0.831505, 0.832615, 0.833725, 0.834833,&
          .83594, &
        0.837045, 0.838149, 0.839252, 0.840353, 0.841453, 0.842552,& 
          .843649, &
        0.844745, 0.84584, 0.846933, 0.848025, 0.849116, 0.850205,&
        0.851294, 0.85238,& 
        0.853466, 0.85455, 0.855633, 0.856715, 0.857795, 0.858874, &
        0.859952, &
        0.861029, 0.862104, 0.863178, 0.864251, 0.865323, 0.866393,&
        0.867462, &
        0.86853, 0.869597, 0.870663, 0.871727, 0.87279, 0.873852,&
        0.874912, 0.875972,& 
        0.87703, 0.878087, 0.879143, 0.880198, 0.881251, 0.882303, &
        0.883355, &
        0.884405, 0.885453, 0.886501, 0.887548, 0.888593, 0.889637,&
        0.89068, &
        0.891722, 0.892763, 0.893803, 0.894841, 0.895879, 0.896915,& 
        0.89795, &
        0.898984, 0.900017, 0.901049, 0.90208, 0.903109, 0.904138,&
        0.905165, &
        0.906191, 0.907217, 0.908241, 0.909264, 0.910286, 0.911307,& 
        0.912327, &
        0.913346, 0.914363, 0.91538, 0.916396, 0.91741, 0.918424,&
        0.919436, 0.920448,& 
        0.921458, 0.922468, 0.923476, 0.924483, 0.92549, 0.926495, &
        0.927499, &
        0.928502, 0.929504, 0.930506, 0.931506, 0.932505, 0.933503, &
        0.9345, 0.935497,&
        0.936492, 0.937486, 0.938479, 0.939471, 0.940463, 0.941453/)

        end subroutine init_sphacc

        subroutine del_sphacc()
        deallocate(uvals); deallocate(tvals)
        deallocate(rvals); deallocate(vvals)
        end subroutine del_sphacc

        subroutine sphacc_vals(u,n,B,T,ur)
        real, dimension(:), intent(in) :: u
        real, dimension(size(u)), intent(out) :: n,B,T,ur
        real :: gamma, alpha, ninf, rho0, tin, tinf,us
        ! Parameters and flow results
        gamma = 5.d0/3.d0      ! This is gamma at infinity
        alpha = 1.d0/4.d0
        ninf  = 1.d0
        Tinf  = .917d-9
! 10^4 K in proton rest energy units, see e.g. Michel (1972)
        Tin   = 1.0d11  ! In Kelvin
        us    = .94d0            ! Fluid velocity at rs in units of c   
        n=ninf*alpha/4./us*(2*gamma*Tinf)**(-1.5d0)*(2.d0*u)**(1.5d0)
        T=temper(u)
!        write(6,*) 'sphvals: ', u, T
        B=sqrt(8.*pi*n*mp/2.*c2*u)
        ur=vel(u)

        contains

        function vel(u)
        real, intent(in), dimension(:) :: u
        real, dimension(size(u)) :: vel
        real :: weight
        integer :: i
        integer :: lindx=1
        do i=1,size(u)
          call get_weight(uvals,u(i),lindx,weight)
          vel(i)=(1d0-weight)*vvals(lindx)+weight*vvals(lindx+1)
        enddo
        end function vel

        function temper(u)
        real, dimension(:), intent(in) :: u
        real, dimension(size(u)) :: temper
        real, dimension(size(rvals)) :: uv
        real :: weight
        integer :: i,lindx
        uv=1d0/rvals
        do i=1,size(u)
          call get_weight(uv,u(i),lindx,weight)
          temper(i)=(1d0-weight)*tvals(lindx)+weight*tvals(lindx+1)
        enddo
!        write(6,*) 'temper: ',uv(1),u(1),lindx,weight, &
!        tvals(lindx),tvals(lindx+1)
        end function temper
  
      end subroutine sphacc_vals

      end module fluid_model_sphacc

